# name: Deploy

# on:
#   push:
#     branches: [main]

# jobs:
#   build:
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v3

#       - name: Setup Node.js
#         uses: actions/setup-node@v3
#         with:
#           node-version: 18

#       - name: Install dependencies
#         run: npm install

#       - name: Build and export
#         run: npm run build

#       - name: Prepare deployment folder
#         run: |
#           mv out ../out
#           rm -rf *
#           mv ../out/* .
#           echo 'iamshabani.ir' > CNAME

#       - name: Set Git identity
#         run: |
#           git config --local user.email "ali.shabani7811@gmail.com"
#           git config --local user.name "Ali Shabani"
#           git add -A
#           git commit -m "Deploy to gh-pages" || echo "No changes to commit"

#       - name: Push to gh-pages
#         uses: ad-m/github-push-action@master
#         with:
#           github_token: ${{secrets.GH_TOKEN}}
#           branch: gh-pages
#           force: true


name: Deploy Next.js to GitHub Pages

on:
  push:
    branches: [main]

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build with Next.js
        run: |
          npm run build
          npm run export
        env:
          NEXT_PUBLIC_BASE_PATH: '/DevHeavenX'

      - name: Generate CNAME
        run: echo 'iamshabani.ir' > out/CNAME

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: 'out/'

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v3